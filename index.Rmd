---
title: "rhandsontable"
output:
  html_document:
    css: custom.css
    toc: true
    toc_depth: 3
    self_contained: false
    lib_dir: libs
    theme: readable
---
```{r echo = FALSE}
library(rhandsontable)
library(knitr)

opts_knit$set(warning = FALSE, error = FALSE, message = FALSE, cache = FALSE)
```

## Introduction

  rhandsontable is a htmlwidget based on the [handsontable.js](www.handsontable.com) library.

> Handsontable is a data grid component with an Excel-like appearance. Built in JavaScript, it integrates with any data source with peak efficiency. It comes with powerful features like data validation, sorting, grouping, data binding, formula support or column ordering.
([via](www.handsontable.com))

## Column Types

The table includes support for numeric, logical, character and Date types.  Logical values will appear as check boxes, and the [pikaday.js](https://github.com/dbushell/Pikaday) library is used to specify Date values.

rhandsontable attempts to map R classes to an appropriate handsontable type.  Factors will be mapped to `dropdown`, with the choices specified by `level`.

To improve readability, `NA` values will be displayed as blank cells.  This requires converting columns containing `NA` to characters, and in the case of factors and Dates, may not display the data in the desired format.  It may be beneficial to concert these type of columns to character before passing to `rhandsontable`.

```{r fig.height = 3}
DF_na = data.frame(val = c(NA, 2:10), 
                   bool = c(NA, rep(TRUE, 9)), 
                   big = c(NA, LETTERS[1:9]),
                   small = c(NA, factor(letters[1:9])),
                   dt = c(NA, seq(from = Sys.Date(), by = "days", 
                                  length.out = 9)),
                   stringsAsFactors = FALSE)

DF_na$small_ch = as.character(DF_na$small)
DF_na$dt_ch = c(NA, as.character(seq(from = Sys.Date(), by = "days", 
                                     length.out = 9)))

rhandsontable(DF_na)
```

### Dropdown / Autocomplete

To control character column values, the column type can be specified as `dropdown` or `autocomplete`.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

# try updating big to a value not in the dropdown
rhandsontable(DF, rowHeaders = NULL) %>%
  hot_col(col = "big", type = "dropdown", source = LETTERS) %>%
  hot_col(col = "small", type = "autocomplete", source = letters,
          strict = FALSE)
```

### Password

A column can also be specified as a `password` type.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_col("small", "password")
```

### Sparkline

New in version 0.2, [sparkline.js](http://omnipotent.net/jquery.sparkline/) charts can be added to the table.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

DF$chart = rep(jsonlite::toJSON(list(values=rnorm(10), 
                                     options = list(type = "bar"))), 10)

rhandsontable(DF, rowHeaders = NULL) %>%
  hot_col("chart", renderer = htmlwidgets::JS("renderSparkline"))
```

## Right-Click Menu

Right-clicking in a cell will enable a context menu that includes customizable table actions.  For shiny apps, formatting and comment updates made via the context menu are not currently retained.

### Add / Remove Rows & Columns

By default a user can add or remove table rows and columns, but this functionality can be disabled.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_table(allowRowEdit = FALSE, allowColEdit = FALSE)
```

## Numeric Formatting

Numeric columns are formatted using the [numeral.js](http://numeraljs.com/) library.

```{r fig.height = 3}
DF = data.frame(int = 1:10, float = rnorm(10), cur = rnorm(10) * 1E5,
                lrg = rnorm(10) * 1E8, pct = rnorm(10))

rhandsontable(DF) %>%
  hot_col("float", format = "0.0") %>%
  hot_col("cur", format = "$0,0.00") %>%
  hot_col("lrg", format = "0a") %>%
  hot_col("pct", format = "0%")
```

## Read Only

The whole table and individual columns can to set to `readOnly` to prevent the user from making changes.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF, readOnly = TRUE) %>%
  hot_col("val", readOnly = FALSE)
```

## Sorting

Column sorting can be enabled; sorting only impacts the widget and will not reorder the original data set.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_cols(columnSorting = TRUE)
```

## Highlight Rows & Columns

With larger tables it my be desirable to highlight the row and column for a selected cell.  

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_table(highlightCol = TRUE, highlightRow = TRUE)
```

## Sizing

Column and row dimensions can be customized.  For larger data sets, (multiple) top rows and left columns can be frozen.

```{r fig.height = 7, fig.width = 7}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT, width = 700, height = 700) %>%
  hot_cols(colWidths = 100) %>%
  hot_rows(rowHeights = 50)
```

The table can be streched to the full width by passing `stretchH = "all"` to `rhandsontable` (or `hot_table`).

## Fixed Rows / Columns

For larger data sets, (multiple) top rows and left columns can be frozen.

```{r fig.height = 7, fig.width = 7}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_cols(fixedColumnsLeft = 1) %>%
  hot_rows(fixedRowsTop = 1)
```

## Cell Comments

Comments (hover) can also be added to individual cells and will appear as red flags in the upper right of the cell.  Comments can also be added via the right-click context menu, but these updates will not currently be retained by shiny.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_cell(1, 1, "Test comment")
```

## Grouping

It is also possible to group rows and columns.

```{r fig.height = 5}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(groups = list(list(cols = c(0, 1)),
                          list(rows = c(0, 1))))
```

## Borders

Custom borders can be drawn around cells to highlight specific items.  Borders can also be added via the right-click context menu, but these updates will not currently be retained by shiny.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(customBorders = list(list(
    range = list(from = list(row = 1, col = 1),
                 to = list(row = 2, col = 2)),
    top = list(width = 2, color = "red"),
    left = list(width = 2, color = "red"),
    bottom = list(width = 2, color = "red"),
    right = list(width = 2, color = "red"))))
```

## Validation

Pre-defined validation can be added for numeric columns in two ways:

  * specify a min and max and any values within the range to exclude
* similar to a `dropdown` column, specify allowed values

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT * 10) %>%
  hot_validate_numeric(col = 1, min = -50, max = 50, exclude = 40)

rhandsontable(MAT * 10) %>%
  hot_validate_numeric(col = 1, choices = c(10, 20, 40))
```

For character columns, a vector of allowed options can be specified.  A more user-friendly approach may be to use a `dropdown` column with `strict = TRUE`.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_validate_character(col = "big", choices = LETTERS[1:10])
```

It is also possible to create a custom validation function in JavaScript.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

# try to update any cell to 0
rhandsontable(MAT * 10) %>%
  hot_cols(validator = "
           function (value, callback) {
            setTimeout(function(){
              callback(value != 0);
            }, 1000)
           }",
           allowInvalid = FALSE)
```

## Conditional Formatting

Conditional formatting can also be specified via custom JavaScript function.

```{r fig.height = 3, fig.width = 8}
MAT = matrix(runif(100, -1, 1), nrow = 10,
             dimnames = list(LETTERS[1:10], LETTERS[1:10]))
diag(MAT) = 1
MAT[upper.tri(MAT)] = MAT[lower.tri(MAT)]
rhandsontable(MAT, readOnly = TRUE) %>%
  hot_cols(renderer = "
           function (instance, td, row, col, prop, value, cellProperties) {
             Handsontable.renderers.TextRenderer.apply(this, arguments);
             if (row == col) {
              td.style.background = 'lightgrey';
             } else if (col > row) {
              td.style.background = 'grey';
              td.style.color = 'grey';
             } else if (value < -0.75) {
              td.style.background = 'pink';
             } else if (value > 0.75) {
              td.style.background = 'lightgreen';
             }
           }")
```

## Export to CSV

Use the `exportToCsv` (experimental) parameter to enable a saving the table data to a csv using a right-click menu option.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(exportToCsv = TRUE)
```

## Heatmap

The [chroma.js](http://old.driven-by-data.net/about/chromajs/) library can be used to turn the table into a heatmap.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_heatmap()
```

## Shiny

The data grid will be editable by default and can be used as input to a shiny app.  A few shiny example links are listed below.  Note that the shinyapps.io links may not work if the has hit the monthly usage limit.

* [Output only](https://jrowen.shinyapps.io/rhandsontable_output)
```
shiny::runGitHub("rhandsontable", "jrowen", 
                 subdir = "inst/examples/rhandsontable_output")
```
* [Calculation input](https://jrowen.shinyapps.io/rhandsontable_portfolio)
```
shiny::runGitHub("rhandsontable", "jrowen", 
                 subdir = "inst/examples/rhandsontable_portfolio")
```
* [Table callback linked to chart](https://jrowen.shinyapps.io/rhandsontable_corr)
```
shiny::runGitHub("rhandsontable", "jrowen", 
                 subdir = "inst/examples/rhandsontable_corr")
```
* [Date file editor](https://jrowen.shinyapps.io/rhandsontable_datafile)
```
shiny::runGitHub("rhandsontable", "jrowen", 
                 subdir = "inst/examples/rhandsontable_datafile")
```
* [Multiple input tables](https://jrowen.shinyapps.io/rhandsontable_frontier)
```
shiny::runGitHub("rhandsontable", "jrowen", 
                 subdir = "inst/examples/rhandsontable_frontier")
```

## Suggestions & Contributions

Please file a issue if you experience any problems with the widget or have feature requests.  Pull requests are also welcome.
