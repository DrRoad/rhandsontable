---
title: "rhandsontable"
output:
  html_document:
    css: custom.css
    toc: true
    toc_depth: 2
    self_contained: false
    lib_dir: libs
    theme: readable
---
```{r echo = FALSE}
library(rhandsontable)
library(knitr)

opts_knit$set(warning = FALSE, error = FALSE, message = FALSE, cache = FALSE)
```

## Introduction

  rhandsontable is an htmlwidget based on the [handsontable.js](www.handsontable.com) library.

> Handsontable is a data grid component with an Excel-like appearance. Built in JavaScript, it integrates with any data source with peak efficiency. It comes with powerful features like data validation, sorting, grouping, data binding, formula support or column ordering.
([via](www.handsontable.com))

The table includes support for numeric, logical, character and Date types.  Logical values will appear as check boxes, and the [pikaday.js](https://github.com/dbushell/Pikaday) library is used to specify Date values.

## Right-Click Menu

Right-clicking in a cell will enable a context menu that includes customizable table actions.  For shiny apps, formatting and comment updates made via the context menu are not currently retained.

## Column Types

rhandsontable attempts to map R classes to an appropriate handsontable type: `string`, `numeric` and `date`.  Factors will be mapped to `dropdown`, and `NA` values will be displayed as blank cells.  

```{r fig.height = 3}
DF = data.frame(val = c(NA, 2:10), 
                bool = c(NA, rep(TRUE, 9)), 
                big = c(NA, LETTERS[1:9]),
                small = c(NA, factor(letters[1:9])),
                dt = c(NA, seq(from = Sys.Date(), by = "days", length.out = 9)),
                dt_ch = c(NA, as.character(seq(from = Sys.Date(), by = "days", 
                                               length.out = 9))),
                stringsAsFactors = FALSE)

rhandsontable(DF)
```

### Dropdown/Autocomplete

To control character column values, the column type can be specified as `dropdown` or `autocomplete`.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

# try updating big to a value not in the dropdown
rhandsontable(DF, rowHeaders = NULL) %>%
  hot_col(col = "big", type = "dropdown", source = LETTERS) %>%
  hot_col(col = "small", type = "autocomplete", source = letters,
          strict = FALSE)
```

### Password

A column can also be specified as a `password` type, and the whole table can to set to `readOnly` to prevent the user from making changes.  Comments (hover) can also be added to individual cells and will appear as red flags in the upper right of the cell.  Comments can also be added via the right-click context menu, but these updates will not currently be retained by shiny.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF, readOnly = TRUE) %>%
  hot_col("small", "password") %>%
  hot_cell(1, 1, "Test comment")
```

### Sparkline

New in version 0.2, [sparkline.js](http://omnipotent.net/jquery.sparkline/) charts can be added to the table.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

DF$chart = rep(jsonlite::toJSON(list(values=rnorm(10), 
                                     options = list(type = "bar"))), 10)

rhandsontable(DF, rowHeaders = NULL) %>%
  hot_col("chart", renderer = htmlwidgets::JS("renderSparkline"))
```

## Numeric Formatting

Numeric columns are formatted using the [numeral.js](http://numeraljs.com/) library.

```{r fig.height = 3}
DF = data.frame(int = 1:10, float = rnorm(10))

rhandsontable(DF, readOnly = TRUE) %>%
  hot_col("float", format = "0.0")
```

## Sorting

Column sorting can be enabled; sorting only impacts the widget and will not reorder the original data set.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_cols(columnSorting = TRUE)
```

## Add/Remove Rows & Columns

With larger tables it my be desirable to highlight the row and column for a selected cell.  By default a user can add or remove table rows and columns, but this functionality can be disabled.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_table(highlightCol = TRUE, highlightRow = TRUE,
            allowRowEdit = FALSE, allowColEdit = FALSE)
```

## Dimensions & Fixed Rows/Columns

Column and row dimensions can be customized.  For larger data sets, (multiple) top rows and left columns can be frozen.

```{r fig.height = 7, fig.width = 7}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT, width = 700, height = 700) %>%
  hot_cols(colWidths = 100, fixedColumnsLeft = 1) %>%
  hot_rows(rowHeights = 50, fixedRowsTop = 1)
```

The table can be streched to the full width by passing `stretchH = "all"` to `rhandsontable` (or `hot_table`).

## Grouping

It is also possible to group rows and columns.

```{r fig.height = 5}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(groups = list(list(cols = c(0, 1)),
                          list(rows = c(0, 1))))
```

## Borders

Custom borders can be drawn around cells to highlight specific items.  Borders can also be added via the right-click context menu, but these updates will not currently be retained by shiny.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(customBorders = list(list(
    range = list(from = list(row = 1, col = 1),
                 to = list(row = 2, col = 2)),
    top = list(width = 2, color = "red"),
    left = list(width = 2, color = "red"),
    bottom = list(width = 2, color = "red"),
    right = list(width = 2, color = "red"))))
```

## Validation

Pre-defined validation can be added for numeric columns in two ways:

  * specify a min and max and any values within the range to exclude
* similar to a `dropdown` column, specify allowed values

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT * 10) %>%
  hot_validate_numeric(col = 1, min = -50, max = 50, exclude = 40)

rhandsontable(MAT * 10) %>%
  hot_validate_numeric(col = 1, choices = c(10, 20, 40))
```

For character columns, a vector of allowed options can be specified.  A more user-friendly approach may be to use a `dropdown` column with `strict = TRUE`.

```{r fig.height = 3}
DF = data.frame(val = 1:10, bool = TRUE, big = LETTERS[1:10],
                small = letters[1:10],
                dt = seq(from = Sys.Date(), by = "days", length.out = 10),
                stringsAsFactors = FALSE)

rhandsontable(DF) %>%
  hot_validate_character(col = "big", choices = LETTERS[1:10])
```

It is also possible to create a custom validation function in JavaScript.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

# try to update any cell to 0
rhandsontable(MAT * 10) %>%
  hot_cols(validator = "
           function (value, callback) {
            setTimeout(function(){
              callback(value != 0);
            }, 1000)
           }",
           allowInvalid = FALSE)
```

## Conditional Formatting

Conditional formatting can also be specified via custom JavaScript function.

```{r fig.height = 3, fig.width = 8}
MAT = matrix(runif(100, -1, 1), nrow = 10,
             dimnames = list(LETTERS[1:10], LETTERS[1:10]))
diag(MAT) = 1
MAT[upper.tri(MAT)] = MAT[lower.tri(MAT)]
rhandsontable(MAT, readOnly = TRUE) %>%
  hot_cols(renderer = "
           function (instance, td, row, col, prop, value, cellProperties) {
             Handsontable.renderers.TextRenderer.apply(this, arguments);
             if (row == col) {
              td.style.background = 'lightgrey';
             } else if (col > row) {
              td.style.background = 'grey';
              td.style.color = 'grey';
             } else if (value < -0.75) {
              td.style.background = 'pink';
             } else if (value > 0.75) {
              td.style.background = 'lightgreen';
             }
           }")
```

## Export to CSV

Use the `exportToCsv` (experimental) parameter to enable a saving the table data to a csv using a right-click menu option.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_table(exportToCsv = TRUE)
```

## Heatmap

The [chroma.js](http://old.driven-by-data.net/about/chromajs/) library can be used to turn the table into a heatmap.

```{r fig.height = 3}
MAT = matrix(rnorm(50), nrow = 10, dimnames = list(LETTERS[1:10],
                                                   letters[1:5]))

rhandsontable(MAT) %>%
  hot_heatmap()
```

## Shiny

The data grid will be editable by default and can be used as input to a shiny app.  A few shiny examples:

* Output only
```
shiny::runGitHub("rhandsontable", "jrowen", subdir = "inst/examples/rhandsontable_output")
```
* Calculation input
```
shiny::runGitHub("rhandsontable", "jrowen", subdir = "inst/examples/rhandsontable_portfolio")
```
* Table callback linked to chart
```
shiny::runGitHub("rhandsontable", "jrowen", subdir = "inst/examples/rhandsontable_corr")
```
* Date file editor
```
shiny::runGitHub("rhandsontable", "jrowen", subdir = "inst/examples/rhandsontable_datafile")
```
* Multiple input tables
```
shiny::runGitHub("rhandsontable", "jrowen", subdir = "inst/examples/rhandsontable_frontier")
```

Please file a issue if you experience any problems with the widget or have feature requests.  Pull requests are also welcome.
